<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>账号密码管理系统 - 功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>账号密码管理系统 - 功能测试</h1>
    
    <div class="test-section">
        <h2>1. 基础功能测试</h2>
        <div class="test-grid">
            <button onclick="testLocalStorage()">测试本地存储</button>
            <button onclick="testUtils()">测试工具函数</button>
            <button onclick="testDataManager()">测试数据管理</button>
            <button onclick="testUIRenderer()">测试UI渲染</button>
        </div>
        <div id="basic-test-results"></div>
    </div>

    <div class="test-section">
        <h2>2. 分类管理测试</h2>
        <div class="test-grid">
            <button onclick="testAddCategory()">测试添加分类</button>
            <button onclick="testDeleteCategory()">测试删除分类</button>
            <button onclick="testCategoryValidation()">测试分类验证</button>
        </div>
        <div id="category-test-results"></div>
    </div>

    <div class="test-section">
        <h2>3. 账号管理测试</h2>
        <div class="test-grid">
            <button onclick="testAddAccount()">测试添加账号</button>
            <button onclick="testUpdateAccount()">测试更新账号</button>
            <button onclick="testDeleteAccount()">测试删除账号</button>
            <button onclick="testSearchAccounts()">测试搜索功能</button>
        </div>
        <div id="account-test-results"></div>
    </div>

    <div class="test-section">
        <h2>4. 安全功能测试</h2>
        <div class="test-grid">
            <button onclick="testPasswordToggle()">测试密码显示/隐藏</button>
            <button onclick="testCopyToClipboard()">测试复制功能</button>
            <button onclick="testDataEncryption()">测试数据加密</button>
        </div>
        <div id="security-test-results"></div>
    </div>

    <div class="test-section">
        <h2>5. 响应式设计测试</h2>
        <div class="test-grid">
            <button onclick="testResponsiveDesign()">测试响应式布局</button>
            <button onclick="testModalFunctionality()">测试模态框功能</button>
            <button onclick="testFormValidation()">测试表单验证</button>
        </div>
        <div id="ui-test-results"></div>
    </div>

    <div class="test-section">
        <h2>6. 完整功能测试</h2>
        <button onclick="runFullTest()" style="background: #28a745;">运行完整测试</button>
        <div id="full-test-results"></div>
    </div>

    <script>
        // 测试结果记录
        let testResults = [];

        function addTestResult(section, testName, success, message) {
            const result = {
                section,
                testName,
                success,
                message,
                timestamp: new Date().toISOString()
            };
            testResults.push(result);
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            
            const container = document.getElementById(`${section}-test-results`);
            container.appendChild(resultDiv);
            
            console.log(`${testName}: ${success ? 'PASS' : 'FAIL'} - ${message}`);
        }

        // 1. 基础功能测试
        function testLocalStorage() {
            try {
                localStorage.setItem('test', 'test-value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (value === 'test-value') {
                    addTestResult('basic', '本地存储测试', true, '本地存储功能正常');
                } else {
                    addTestResult('basic', '本地存储测试', false, '本地存储读取失败');
                }
            } catch (error) {
                addTestResult('basic', '本地存储测试', false, `本地存储错误: ${error.message}`);
            }
        }

        function testUtils() {
            try {
                // 测试ID生成
                const id1 = Date.now().toString(36) + Math.random().toString(36).substr(2);
                const id2 = Date.now().toString(36) + Math.random().toString(36).substr(2);
                
                if (id1 !== id2 && id1.length > 0 && id2.length > 0) {
                    addTestResult('basic', '工具函数测试', true, 'ID生成功能正常');
                } else {
                    addTestResult('basic', '工具函数测试', false, 'ID生成功能异常');
                }
            } catch (error) {
                addTestResult('basic', '工具函数测试', false, `工具函数错误: ${error.message}`);
            }
        }

        function testDataManager() {
            try {
                // 模拟数据管理功能
                const testData = { test: 'value' };
                const testDataString = JSON.stringify(testData);
                const parsedData = JSON.parse(testDataString);
                
                if (JSON.stringify(parsedData) === testDataString) {
                    addTestResult('basic', '数据管理测试', true, '数据序列化/反序列化正常');
                } else {
                    addTestResult('basic', '数据管理测试', false, '数据序列化/反序列化失败');
                }
            } catch (error) {
                addTestResult('basic', '数据管理测试', false, `数据管理错误: ${error.message}`);
            }
        }

        function testUIRenderer() {
            try {
                // 测试DOM操作
                const testElement = document.createElement('div');
                testElement.textContent = '测试元素';
                document.body.appendChild(testElement);
                document.body.removeChild(testElement);
                
                addTestResult('basic', 'UI渲染测试', true, 'DOM操作功能正常');
            } catch (error) {
                addTestResult('basic', 'UI渲染测试', false, `UI渲染错误: ${error.message}`);
            }
        }

        // 2. 分类管理测试
        function testAddCategory() {
            try {
                const testCategory = {
                    name: '测试分类',
                    icon: 'fas fa-test'
                };
                
                if (testCategory.name && testCategory.icon) {
                    addTestResult('category', '添加分类测试', true, '分类数据结构正确');
                } else {
                    addTestResult('category', '添加分类测试', false, '分类数据结构错误');
                }
            } catch (error) {
                addTestResult('category', '添加分类测试', false, `添加分类错误: ${error.message}`);
            }
        }

        function testDeleteCategory() {
            try {
                const categories = [
                    { id: '1', name: '分类1' },
                    { id: '2', name: '分类2' }
                ];
                
                const filteredCategories = categories.filter(c => c.id !== '1');
                
                if (filteredCategories.length === 1 && filteredCategories[0].id === '2') {
                    addTestResult('category', '删除分类测试', true, '分类删除逻辑正确');
                } else {
                    addTestResult('category', '删除分类测试', false, '分类删除逻辑错误');
                }
            } catch (error) {
                addTestResult('category', '删除分类测试', false, `删除分类错误: ${error.message}`);
            }
        }

        function testCategoryValidation() {
            try {
                const validCategory = { name: '有效分类', icon: 'fas fa-valid' };
                const invalidCategory = { name: '', icon: '' };
                
                const validName = validCategory.name && validCategory.name.length > 0;
                const validIcon = validCategory.icon && validCategory.icon.length > 0;
                const invalidName = !invalidCategory.name || invalidCategory.name.length === 0;
                
                if (validName && validIcon && invalidName) {
                    addTestResult('category', '分类验证测试', true, '分类验证逻辑正确');
                } else {
                    addTestResult('category', '分类验证测试', false, '分类验证逻辑错误');
                }
            } catch (error) {
                addTestResult('category', '分类验证测试', false, `分类验证错误: ${error.message}`);
            }
        }

        // 3. 账号管理测试
        function testAddAccount() {
            try {
                const testAccount = {
                    categoryId: 'test-category',
                    name: '测试账号',
                    username: 'testuser',
                    password: 'testpass',
                    url: 'https://example.com',
                    notes: '测试备注'
                };
                
                const requiredFields = ['categoryId', 'name', 'username', 'password'];
                const allRequired = requiredFields.every(field => testAccount[field]);
                
                if (allRequired) {
                    addTestResult('account', '添加账号测试', true, '账号数据结构正确');
                } else {
                    addTestResult('account', '添加账号测试', false, '账号必填字段缺失');
                }
            } catch (error) {
                addTestResult('account', '添加账号测试', false, `添加账号错误: ${error.message}`);
            }
        }

        function testUpdateAccount() {
            try {
                const originalAccount = { id: '1', name: '原账号', username: 'user1' };
                const updateData = { name: '新账号', username: 'user2' };
                
                const updatedAccount = { ...originalAccount, ...updateData };
                
                if (updatedAccount.name === '新账号' && updatedAccount.username === 'user2') {
                    addTestResult('account', '更新账号测试', true, '账号更新逻辑正确');
                } else {
                    addTestResult('account', '更新账号测试', false, '账号更新逻辑错误');
                }
            } catch (error) {
                addTestResult('account', '更新账号测试', false, `更新账号错误: ${error.message}`);
            }
        }

        function testDeleteAccount() {
            try {
                const accounts = [
                    { id: '1', name: '账号1' },
                    { id: '2', name: '账号2' },
                    { id: '3', name: '账号3' }
                ];
                
                const filteredAccounts = accounts.filter(a => a.id !== '2');
                
                if (filteredAccounts.length === 2 && !filteredAccounts.find(a => a.id === '2')) {
                    addTestResult('account', '删除账号测试', true, '账号删除逻辑正确');
                } else {
                    addTestResult('account', '删除账号测试', false, '账号删除逻辑错误');
                }
            } catch (error) {
                addTestResult('account', '删除账号测试', false, `删除账号错误: ${error.message}`);
            }
        }

        function testSearchAccounts() {
            try {
                const accounts = [
                    { name: 'QQ账号', username: 'qquser' },
                    { name: '百度账号', username: 'baiduser' },
                    { name: '微信账号', username: 'wechatuser' }
                ];
                
                const searchTerm = 'QQ';
                const filteredAccounts = accounts.filter(account => 
                    account.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    account.username.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                if (filteredAccounts.length === 1 && filteredAccounts[0].name === 'QQ账号') {
                    addTestResult('account', '搜索账号测试', true, '搜索功能正常');
                } else {
                    addTestResult('account', '搜索账号测试', false, '搜索功能异常');
                }
            } catch (error) {
                addTestResult('account', '搜索账号测试', false, `搜索账号错误: ${error.message}`);
            }
        }

        // 4. 安全功能测试
        function testPasswordToggle() {
            try {
                const testInput = document.createElement('input');
                testInput.type = 'password';
                testInput.value = 'testpassword';
                
                // 模拟密码显示/隐藏
                const originalType = testInput.type;
                testInput.type = testInput.type === 'password' ? 'text' : 'password';
                const newType = testInput.type;
                testInput.type = originalType;
                
                if (originalType === 'password' && newType === 'text') {
                    addTestResult('security', '密码显示/隐藏测试', true, '密码切换功能正常');
                } else {
                    addTestResult('security', '密码显示/隐藏测试', false, '密码切换功能异常');
                }
            } catch (error) {
                addTestResult('security', '密码显示/隐藏测试', false, `密码切换错误: ${error.message}`);
            }
        }

        function testCopyToClipboard() {
            try {
                // 测试复制功能（模拟）
                const testText = 'test-copy-text';
                const textArea = document.createElement('textarea');
                textArea.value = testText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                addTestResult('security', '复制功能测试', true, '复制功能模拟成功');
            } catch (error) {
                addTestResult('security', '复制功能测试', false, `复制功能错误: ${error.message}`);
            }
        }

        function testDataEncryption() {
            try {
                const testData = { username: 'testuser', password: 'testpass' };
                const encoded = btoa(JSON.stringify(testData));
                const decoded = JSON.parse(atob(encoded));
                
                if (JSON.stringify(decoded) === JSON.stringify(testData)) {
                    addTestResult('security', '数据加密测试', true, '数据编码/解码功能正常');
                } else {
                    addTestResult('security', '数据加密测试', false, '数据编码/解码功能异常');
                }
            } catch (error) {
                addTestResult('security', '数据加密测试', false, `数据加密错误: ${error.message}`);
            }
        }

        // 5. 响应式设计测试
        function testResponsiveDesign() {
            try {
                const viewport = window.innerWidth;
                const isMobile = viewport < 768;
                const isTablet = viewport >= 768 && viewport < 1024;
                const isDesktop = viewport >= 1024;
                
                if (viewport > 0) {
                    addTestResult('ui', '响应式设计测试', true, `当前视口宽度: ${viewport}px`);
                } else {
                    addTestResult('ui', '响应式设计测试', false, '无法获取视口宽度');
                }
            } catch (error) {
                addTestResult('ui', '响应式设计测试', false, `响应式设计错误: ${error.message}`);
            }
        }

        function testModalFunctionality() {
            try {
                // 测试模态框显示/隐藏逻辑
                const modal = document.createElement('div');
                modal.style.display = 'none';
                modal.style.display = 'block';
                modal.style.display = 'none';
                
                addTestResult('ui', '模态框功能测试', true, '模态框显示/隐藏逻辑正常');
            } catch (error) {
                addTestResult('ui', '模态框功能测试', false, `模态框功能错误: ${error.message}`);
            }
        }

        function testFormValidation() {
            try {
                const testForm = {
                    name: '测试表单',
                    required: true,
                    valid: true
                };
                
                if (testForm.name && testForm.required && testForm.valid) {
                    addTestResult('ui', '表单验证测试', true, '表单验证逻辑正常');
                } else {
                    addTestResult('ui', '表单验证测试', false, '表单验证逻辑错误');
                }
            } catch (error) {
                addTestResult('ui', '表单验证测试', false, `表单验证错误: ${error.message}`);
            }
        }

        // 6. 完整功能测试
        function runFullTest() {
            // 清空之前的结果
            document.querySelectorAll('.test-result').forEach(el => el.remove());
            testResults = [];
            
            // 运行所有测试
            testLocalStorage();
            testUtils();
            testDataManager();
            testUIRenderer();
            
            testAddCategory();
            testDeleteCategory();
            testCategoryValidation();
            
            testAddAccount();
            testUpdateAccount();
            testDeleteAccount();
            testSearchAccounts();
            
            testPasswordToggle();
            testCopyToClipboard();
            testDataEncryption();
            
            testResponsiveDesign();
            testModalFunctionality();
            testFormValidation();
            
            // 生成测试报告
            setTimeout(() => {
                generateTestReport();
            }, 1000);
        }

        function generateTestReport() {
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.success).length;
            const failedTests = totalTests - passedTests;
            
            const reportDiv = document.createElement('div');
            reportDiv.className = 'test-result info';
            reportDiv.innerHTML = `
                <h3>测试报告</h3>
                <p><strong>总测试数:</strong> ${totalTests}</p>
                <p><strong>通过测试:</strong> ${passedTests}</p>
                <p><strong>失败测试:</strong> ${failedTests}</p>
                <p><strong>通过率:</strong> ${((passedTests / totalTests) * 100).toFixed(1)}%</p>
                <p><strong>测试时间:</strong> ${new Date().toLocaleString()}</p>
            `;
            
            document.getElementById('full-test-results').appendChild(reportDiv);
            
            console.log('=== 测试报告 ===');
            console.log(`总测试数: ${totalTests}`);
            console.log(`通过测试: ${passedTests}`);
            console.log(`失败测试: ${failedTests}`);
            console.log(`通过率: ${((passedTests / totalTests) * 100).toFixed(1)}%`);
        }

        // 页面加载完成后自动运行基础测试
        window.addEventListener('load', () => {
            console.log('开始功能测试...');
            addTestResult('basic', '页面加载测试', true, '页面加载完成');
        });
    </script>
</body>
</html> 